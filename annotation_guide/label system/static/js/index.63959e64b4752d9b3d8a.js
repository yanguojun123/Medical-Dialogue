webpackJsonp([1,2],{Ie5r:function(t,e){},K0Fr:function(t,e){},P9kb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={bind:function(t,e,a){function n(t,e){t.compareBoundaryPoints(Range.START_TO_START,e)<0&&t.setStart(e.startContainer,e.startOffset),t.compareBoundaryPoints(Range.END_TO_END,e)>0&&t.setEnd(e.endContainer,e.endOffset)}document.body.addEventListener("mouseup",function a(){if(!t.parentElement)return void document.body.removeEventListener("mouseup",a);var s=function(){var a=window.getSelection(),s={allStr:"",fixStr:""};if(a.rangeCount>0){var i=a.getRangeAt(0),r=document.createRange();if(r.selectNode(t),function(t,e){return!(t.compareBoundaryPoints(Range.END_TO_START,e)>0||t.compareBoundaryPoints(Range.START_TO_END,e)<0)}(i,r))if(s.allStr=i.toString(),e.modifiers.fix)n(i,r),s.fixStr=i.toString(),s.range=i;else{var o=i.cloneRange();n(o,r),s.fixStr=o.toString(),o.detach(),s.range=o}}return s}();s.fixStr&&e.value.getSelection&&e.value.getSelection(s.fixStr,s.allStr,s.range)})}};e.default=n},U67u:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("/5sW"),s=a("mvHQ"),i=a.n(s),r=a("Gu7T"),o=a.n(r),l=a("Dd8w"),c=a.n(l),d=a("bm7V"),u=a.n(d),p={props:{data:{type:Object}},methods:{formatTime:function(t){return t instanceof Date?this.prefixInteger(t.getFullYear(),4)+"-"+this.prefixInteger(t.getMonth()+1,2)+"-"+this.prefixInteger(t.getDate(),2)+" "+this.prefixInteger(t.getHours(),2)+":"+this.prefixInteger(t.getMinutes(),2)+":"+this.prefixInteger(t.getSeconds(),2):t+""},prefixInteger:function(t,e){return(Array(e).join("0")+t).slice(-e)}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-container"},[t.data.time?a("div",{staticClass:"time",class:{left:"left"===t.data.position}},[t._v(t._s(t.formatTime(t.data.time)))]):t._e(),t._v(" "),t.data.topText?a("div",{staticClass:"time",class:{left:"left"===t.data.position}},[t._v("  "+t._s(t.data.topText)+"  ")]):t._e(),t._v(" "),a("div",{staticClass:"avatar",style:{float:t.data.position}},[a("Avatar",{style:{background:1==t.data.color?"red":t.data.color||"#f56a00"}},[t._v(t._s(t.data.user))])],1),t._v(" "),a("div",{staticClass:"message-body",class:{color:!0===t.data.color},style:{float:t.data.position}},[a("div",{staticClass:"arrow",class:{left:"left"===t.data.position}}),t._v(" "),a("p",{domProps:{innerHTML:t._s(t.data.message)}})]),t._v(" "),a("div",{staticClass:"clearfix"})])},staticRenderFns:[]};var m=a("VU/8")(p,f,!1,function(t){a("xgGb")},"data-v-e747e91a",null).exports,h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("Tooltip",{attrs:{content:this.content,transfer:"","max-width":200},on:{"on-popper-show":this.showTooltip}},[e("Icon",{staticStyle:{position:"relative",right:"0"},attrs:{type:"md-help-circle"}})],1)},staticRenderFns:[]},g={model:{event:"change",prop:"value"},props:["value"],components:{helpTooltip:a("VU/8")({props:["content"],methods:{showTooltip:function(){this.$emit("showTooltip")}}},h,!1,null,null,null).exports},watch:{formValidate:{handler:function(t,e){this.$emit("change",t)},deep:!0},value:{handler:function(t,e){this.formData(t)},deep:!0,immediate:!0},currentPage:function(t){this.pageChange(t)}},data:function(){return{formValidate:{text:"",range:"",intent:"",slot:"",aspect:"",value:""},slots:[],aspects:[],labels:window.labels,remote:!1,loadingAspect:!1,needPagination:!1,currentPage:0,pageSize:10,query:"",hasNextPage:!0}},methods:{formData:function(t){var e=!0;for(var a in t){var n=t[a];e=e&&this.formValidate[a]===n}e||(this.formValidate={text:t.text,range:t.range,intent:t.intent},this.value.slot&&(this.intentChange(this.value.intent),0===this.slots.filter(function(e){return t.slot===e.name}).length&&this.createSlot(t.slot),this.formValidate.slot=t.slot),this.value.aspect&&(this.slotChange(this.value.slot),0===this.aspects.filter(function(e){return t.aspect===e.name}).length&&this.createAspect(this.value.aspect),this.formValidate.aspect=t.aspect))},createSlot:function(t){this.slots.push({name:t,title:t})},createAspect:function(t){this.aspects.push({name:t,title:t})},intentChange:function(t){var e=this;this.formValidate.slot="",this.formValidate.aspect="",this.slots=[],this.aspects=[],this.labels.slots.map(function(a){a.activeIntents.indexOf(t)>=0&&e.slots.push(a)})},slotChange:function(t){var e=this;this.formValidate.aspect="",this.aspects=[],this.slots.filter(function(e){return e.name===t&&e.loadData}).length>0||this.labels.aspects.map(function(a){a.activeSlots.indexOf(t)>=0&&e.aspects.push(a)})},aspectQueryChange:function(t){var e=this;t&&this.slots.filter(function(t){return t.name===e.formValidate.slot&&t.loadData}).length>0&&(this.loadingAspect=!0,this.searchAspects(t,0),this.loadingAspect=!1)},searchAspects:function(t,e){var a=this,n=window[this.formValidate.slot+"_index"].search({query:t,limit:this.pageSize,page:e+""});this.aspects=[],this.query=t,this.needPagination=!0,this.currentPage=Math.floor(e/this.pageSize),this.hasNextPage=null!==n.next,n.result&&n.result.map(function(t){var e=window[a.formValidate.slot+"_indexData"][t];a.aspects.push({name:e,title:e})})},pageChange:function(t){this.aspects=[],this.searchAspects(this.query,t*this.pageSize)}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{ref:"formValidate",attrs:{model:t.formValidate}},[a("FormItem",{attrs:{label:"语句(sentence)",prop:"name"}},[a("Input",{attrs:{placeholder:"在原始消息中选择一部分……",type:"textarea"},model:{value:t.formValidate.text,callback:function(e){t.$set(t.formValidate,"text",e)},expression:"formValidate.text"}})],1),t._v(" "),a("FormItem",{attrs:{label:"下标(index)",prop:"index"}},[a("InputNumber",{model:{value:t.formValidate.range[0],callback:function(e){t.$set(t.formValidate.range,0,e)},expression:"formValidate.range[0]"}}),t._v(" "),a("InputNumber",{model:{value:t.formValidate.range[1],callback:function(e){t.$set(t.formValidate.range,1,e)},expression:"formValidate.range[1]"}})],1),t._v(" "),a("FormItem",{attrs:{label:"意图(Intent)",prop:"intent"}},[a("Select",{attrs:{placeholder:"选择intent...",placement:"top"},on:{"on-change":t.intentChange},model:{value:t.formValidate.intent,callback:function(e){t.$set(t.formValidate,"intent",e)},expression:"formValidate.intent"}},t._l(t.labels.intents,function(e){return a("Option",{key:e.name,attrs:{value:e.name,label:e.title}},[t._v("\n          "+t._s(e.title)+"\n          "),e.desc?a("helpTooltip",{attrs:{content:e.desc}}):t._e()],1)}),1)],1),t._v(" "),a("FormItem",{attrs:{label:"槽位(Slot)",prop:"slot"}},[a("Select",{attrs:{placeholder:"选择或填写slot...",disabled:!t.formValidate.intent,filterable:"","allow-create":"",placement:"top"},on:{"on-change":t.slotChange,"on-create":t.createSlot},model:{value:t.formValidate.slot,callback:function(e){t.$set(t.formValidate,"slot",e)},expression:"formValidate.slot"}},t._l(t.slots,function(e){return a("Option",{key:e.name,attrs:{value:e.name,label:e.title}},[t._v("\n          "+t._s(e.title)+"\n          "),e.desc?a("helpTooltip",{attrs:{content:e.desc}}):t._e()],1)}),1)],1),t._v(" "),a("FormItem",{attrs:{label:"槽值1(Value1)",prop:"aspect"}},[a("Select",{directives:[{name:"debounce",rawName:"v-debounce",value:t.aspectQueryChange,expression:"aspectQueryChange"}],attrs:{placeholder:"选择或填写aspect...",disabled:!t.formValidate.intent||!t.formValidate.slot,filterable:"",remote:"",loading:t.loadingAspect,"allow-create":"",placement:"top"},on:{"on-create":t.createAspect},model:{value:t.formValidate.aspect,callback:function(e){t.$set(t.formValidate,"aspect",e)},expression:"formValidate.aspect"}},t._l(t.aspects,function(e,n){return a("Option",{key:e.name+"--"+n,attrs:{value:e.name,label:e.title}},[t._v("\n          "+t._s(e.title)+"\n          "),t.needPagination&&0==n?a("ButtonGroup",{staticStyle:{float:"right","z-index":"999"},on:{click:function(t){t.stopPropagation()}}},[a("Button",{attrs:{type:"primary",size:"small",disabled:0===t.currentPage},on:{click:function(e){e.stopPropagation(),t.currentPage--}}},[a("Icon",{attrs:{type:"ios-arrow-back"}})],1),t._v(" "),a("Button",{attrs:{type:"primary",size:"small",disabled:!t.hasNextPage}},[a("Icon",{attrs:{type:"ios-arrow-forward"},on:{click:function(e){e.stopPropagation(),t.currentPage++}}})],1)],1):t._e(),t._v(" "),e.desc?a("helpTooltip",{attrs:{content:e.desc}}):t._e()],1)}),1)],1),t._v(" "),a("FormItem",{attrs:{label:"槽值2(Value2)",prop:"result"}},[a("Select",{model:{value:t.formValidate.value,callback:function(e){t.$set(t.formValidate,"value",e)},expression:"formValidate.value"}},[a("Option",{attrs:{value:"yes"}},[t._v("Yes")]),t._v(" "),a("Option",{attrs:{value:"no"}},[t._v("No")]),t._v(" "),a("Option",{attrs:{value:"notSure"}},[t._v("Not sure")])],1)],1)],1)},staticRenderFns:[]},_=a("VU/8")(g,v,!1,null,null,null).exports,x=new FileReader,y={container:"#chatPanel",easing:"ease-in",offset:-60,force:!0,cancelable:!0,x:!1,y:!0},b={components:{message:m,actionPanel:_},data:function(){return{height:window.screen.availHeight-150,fileName:"",messages:[],userConfig:c()({},window.chatterConfig),currentIndex:0,loading:!1,currentActions:[],actions:[],currentRange:[],currentSelection:""}},watch:{"currentActions.length":function(t,e){var a=c()({},this.messages[this.currentIndex],{topText:t>0?"已标注(labeled)":"未标注(unlabeled)"});this.$set(this.messages,this.currentIndex+"",a)},currentIndex:function(t,e){u.a.scrollTo("#message_"+t,200,y),this.actions[e]=[].concat(o()(this.currentActions)),this.currentActions=[].concat(o()(this.actions[t]))}},methods:{clearSelection:function(){this.currentSelection="",this.currentRange=[0,0]},addAction:function(){this.currentActions.unshift({key:this.currentIndex+"--"+this.currentActions.length,text:this.currentSelection,range:this.currentRange}),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()},deleteAction:function(t){this.currentActions.splice(t,1)},actionRangeChange:function(t,e,a){var n=a.endContainer.wholeText;1===a.endOffset&&(n=a.startContainer.wholeText);for(var s=0;s<n.length&&("\r"===n[s]||"\n"===n[s]||" "===n[s]||"\t"===n[s]);s++);this.currentSelection=t.trim();var i=0===a.startOffset?0:a.startOffset-s;this.currentRange=[i,i+t.trim().length-1]},messageSelected:function(t){this.currentIndex=t},readFile:function(t){var e=this;this.loading=!0;var a=t.target.files[0];this.messages=[],x.addEventListener("loadend",function(){JSON.parse(x.result).dialogues.map(function(t,a){e.messages[a]=c()({},t,{message:t.sentence,position:e.userConfig[t.role].position,user:e.userConfig[t.role].title,color:"left"!==e.userConfig[t.role].position,topText:"未标注(unlabeled)",userName:t.role}),e.actions.push({})}),e.fileName=a.name,e.loading=!1}),x.readAsText(a)},readLabelled:function(t){var e=this;this.loading=!0;var a=t.target.files[0];this.messages=[],x.addEventListener("loadend",function(){JSON.parse(x.result).map(function(t,a){e.messages[a]=c()({},t),e.actions[a]=t.actions}),e.currentIndex=0,e.currentActions=[].concat(o()(e.actions[0])),e.fileName=a.name,e.loading=!1}),x.readAsText(a)},generateFile:function(){this.actions[this.currentIndex]=[].concat(o()(this.currentActions));var t=document.createElement("a"),e=[],a=!0,n=0;for(n=0;n<this.messages.length;n++){var s=this.messages[n],r=this.actions[n];if(e[n]=c()({},s,{actions:r}),!(a=a&&r.length>0))break}if(!a)return this.$Message.error({content:"还有尚未标注的项目，请先完成！"}),console.log(n),void(this.currentIndex=n);var l=new Blob([i()(e,null,2)]);t.download=this.fileName+"-labelled.json",t.href=URL.createObjectURL(l),t.click(),URL.revokeObjectURL(l)}}},S={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",{attrs:{"dis-hover":"",bordered:!1,padding:8}},[a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"title"},slot:"title"},[a("strong",[t._v("\n        当前文件(current file)：\n        "),this.fileName?a("tag",{attrs:{color:"blue",type:"border"}},[t._v(t._s(t.fileName))]):a("span",[t._v("无")])],1),t._v(" "),a("div",{staticClass:"wrap"},[a("span",[a("Icon",{attrs:{type:"md-open"}}),t._v("打开对话文件(open dialogue file) ")],1),t._v(" "),a("input",{ref:"fileInput",staticClass:"file",attrs:{id:"fileupload",type:"file"},on:{change:t.readFile}})]),t._v(" "),a("div",{staticClass:"wrap"},[a("span",[a("Icon",{attrs:{type:"md-open"}}),t._v("打开已标注文件(open labeled dialogue file) ")],1),t._v(" "),a("input",{ref:"labelledUpload",staticClass:"file",attrs:{id:"labelledUpload",type:"file"},on:{change:t.readLabelled}})]),t._v(" "),a("Button",{attrs:{type:"text"},on:{click:t.generateFile}},[a("Icon",{attrs:{type:"md-download"}}),t._v("保存已标注文件(save labeled dialogue file)\n      ")],1)],1),t._v(" "),t.loading?a("Spin",{attrs:{size:"large",fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"50"}}),t._v(" "),a("div",[t._v("Loading...")])],1):t._e(),t._v(" "),a("div",[a("Row",{attrs:{gutter:8}},[a("Col",{attrs:{span:10}},[a("Card",{ref:"chatPanel",staticStyle:{background:"#efefef7a","min-height":"400px",overflow:"auto"},style:{height:t.height+"px",overflow:"auto"},attrs:{id:"chatPanel"}},t._l(t.messages,function(e,n){return a("div",{key:"message-"+n,staticStyle:{"border-radius":"10px",padding:"3px"},style:{border:t.currentIndex===n?"1px dashed #1890ff ":"none"},on:{click:function(e){return t.messageSelected(n)}}},[a("message",{attrs:{data:e,id:"message_"+n}})],1)}),0)],1),t._v(" "),t.messages.length>0?a("Col",{attrs:{span:14}},[a("div",{staticStyle:{padding:"10px",overflow:"auto"},style:{height:t.height-20+"px"}},[a("Form",{attrs:{"label-width":80}},[a("ButtonGroup",{staticStyle:{"margin-left":"10px","margin-bottom":"10px"},attrs:{size:"small"}},[a("Button",{attrs:{type:"primary",disabled:0===t.currentIndex},on:{click:function(e){t.currentIndex=t.currentIndex-1}}},[a("Icon",{attrs:{type:"ios-arrow-back"}}),t._v("上一条(previous)\n                ")],1),t._v(" "),a("Button",{attrs:{type:"primary",disabled:t.currentIndex===t.messages.length-1},on:{click:function(e){t.currentIndex=t.currentIndex+1}}},[t._v("\n                  下一条(next)\n                  "),a("Icon",{attrs:{type:"ios-arrow-forward"}})],1)],1),t._v(" "),a("small",{staticStyle:{color:"red"}},[t._v("（选择原始消息标签中的部分内容，点击“添加标签”，系统会直接将已选文本及索引填入对应项 Select some contents in the original message tag and click 'add label', and the system will directly fill the selected text and index into the corresponding items）")]),t._v(" "),a("FormItem",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"消息来自(source)"}},[a("Tag",{attrs:{color:"blue"}},[t._v(t._s(t.messages[t.currentIndex].user))])],1),t._v(" "),a("FormItem",{staticStyle:{"margin-top":"10px"},attrs:{label:"原始消息(Original message)"}},[a("div",{directives:[{name:"selection",rawName:"v-selection",value:{getSelection:t.actionRangeChange},expression:"{ getSelection: actionRangeChange }"},{name:"click-outside",rawName:"v-click-outside",value:t.clearSelection,expression:"clearSelection"}],staticClass:"ivu-input",staticStyle:{height:"100%"}},[a("span",[t._v(t._s(t.messages[t.currentIndex].message))])])])],1),t._v(" "),a("Button",{attrs:{type:t.currentSelection.length>0?"primary":"dashed",long:""},on:{click:t.addAction}},[a("Icon",{attrs:{type:"md-add"}}),t._v("添加标签(add label)")],1),t._v(" "),a("div",{staticStyle:{"padding-top":"10px"}},t._l(t.currentActions,function(e,n){return a("div",{key:e.key,staticStyle:{padding:"3px"}},[a("Card",{staticStyle:{positioin:"relative"}},[a("div",{staticStyle:{postion:"absolute",top:"0",right:"0"}},[a("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.deleteAction(n)}}},[a("Icon",{attrs:{type:"md-close"}})],1)],1),t._v(" "),a("div",[a("actionPanel",{model:{value:t.currentActions[n],callback:function(e){t.$set(t.currentActions,n,e)},expression:"currentActions[index]"}})],1)])],1)}),0)],1)]):t._e()],1)],1)],1)],1)},staticRenderFns:[]};var I=a("VU/8")(b,S,!1,function(t){a("K0Fr")},"data-v-6938c851",null).exports,w=a("b3L9"),V=a.n(w),C=a("kofV"),A=a.n(C),k=a("P9kb"),T=a("dDoS"),R=a.n(T),P=a("B08F"),N=a.n(P);a("Ie5r");n.default.use(V.a,{locale:A.a}),n.default.directive("selection",k.default),n.default.directive("click-outside",R.a),n.default.use(N.a,{listenTo:"input",defaultTime:"1s"}),new n.default({el:"#app",render:function(t){return t(I)}})},xgGb:function(t,e){}},["U67u"]);
//# sourceMappingURL=index.63959e64b4752d9b3d8a.js.map<span class="ivu-tag-text ivu-tag-color-white">病人</span>